<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Miscellanea: things you can do in mgcViz • mgcViz</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Miscellanea: things you can do in mgcViz">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mgcViz</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BayesPost.html">Bayesian posterior simulations and predictive checks</a>
    </li>
    <li>
      <a href="../articles/mgcviz.html">An introduction to mgcViz: visual tools for GAMs</a>
    </li>
    <li>
      <a href="../articles/miscellanea.html">Miscellanea: things you can do in mgcViz</a>
    </li>
    <li>
      <a href="../articles/qgam_mgcViz.html">Quantile additive models using qgam and mgcViz</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mfasiolo/mgcViz">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Miscellanea: things you can do in mgcViz</h1>
                        <h4 class="author">Matteo Fasiolo, Christian Capezza</h4>
            
            <h4 class="date">March 04 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mfasiolo/mgcViz/blob/master/vignettes/miscellanea.Rmd"><code>vignettes/miscellanea.Rmd</code></a></small>
      <div class="hidden name"><code>miscellanea.Rmd</code></div>

    </div>

    
    
<style>
body {
text-align: justify}
</style>
<p>The purpose of this document is detailing a number of potentially useful things you can do in <code>mgcViz</code>.</p>
<div id="accumulated-local-effect-ale-plot-for-gams" class="section level1">
<h1 class="hasAnchor">
<a href="#accumulated-local-effect-ale-plot-for-gams" class="anchor"></a>Accumulated local effect (ALE) plot for GAMs</h1>
<p>As of version 0.1.6, <code>mgcViz</code> provides methods for computing and visualising accumulated local effects (ALE) for GAMs. See <a href="https://arxiv.org/abs/1612.08468">Apley and Zhu (2016)</a> for details regarding this type of effects. Here we explain how such effects can be computed and plotted with <code>mgcViz</code>, while the section titled “Multinomial example” (below) provides an example where plotting ALE effects is more useful than plotting standard GAM effects (that is, the effects specified in the model formula via, e.g, <code>s(x)</code>).</p>
<div id="basic-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-usage" class="anchor"></a>Basic usage</h2>
<p>We start by considering a quantile GAM model for electricity demand:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mgcViz)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(UKload)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">fit &lt;-<span class="st"> </span><span class="kw">qgam</span>(NetDemand <span class="op">~</span><span class="st"> </span>Dow <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(Posan, <span class="dt">k =</span> <span class="dv">20</span>) <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(wM) <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(wM_s95), <span class="dt">data =</span> UKload, <span class="dt">qu =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>## Estimating learning rate. Each dot corresponds to a loss evaluation. 
## qu = 0.5........done</code></pre>
<p>We visualise the ALE effect of smoothed temperature (<code>wM_s95</code>):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="../reference/ALE.html">ALE</a></span>(fit, <span class="dt">x =</span> <span class="st">"wM_s95"</span>))</a></code></pre></div>
<p><img src="miscellanea_files/figure-html/ALE2-1.png" width="384" style="display:block; margin: auto"> The plot above shows a centered ALE effect as in Apley and Zhu (2016), with the default layers. We can use a different level for centering and add some custom layers:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="../reference/ALE.html">ALE</a></span>(fit, <span class="dt">x =</span> <span class="st">"wM_s95"</span>, <span class="dt">center =</span> <span class="dv">2</span>)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/l_ciPoly.html">l_ciPoly</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/l_fitLine.html">l_fitLine</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/l_rug.html">l_rug</a></span>()</a></code></pre></div>
<p><img src="miscellanea_files/figure-html/ALE3-1.png" width="384" style="display:block; margin: auto"> We can avoid centering (so that the plot starts at <span class="math inline">\(y = 0\)</span>) and perform some posterior simulations:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="../reference/ALE.html">ALE</a></span>(fit, <span class="dt">x =</span> <span class="st">"wM_s95"</span>, <span class="dt">center =</span> <span class="dv">0</span>), <span class="dt">nsim =</span> <span class="dv">20</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/l_simLine.html">l_simLine</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/l_fitLine.html">l_fitLine</a></span>()</a></code></pre></div>
<p><img src="miscellanea_files/figure-html/ALE4-1.png" width="384" style="display:block; margin: auto"> We can also plot the ALE effect of factor covariates:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="../reference/ALE.html">ALE</a></span>(fit, <span class="dt">x =</span> <span class="st">"Dow"</span>, <span class="dt">center =</span> <span class="dv">2</span>))</a></code></pre></div>
<p><img src="miscellanea_files/figure-html/ALE5-1.png" width="480" style="display:block; margin: auto"> ALE methods work also for GAMLSS models (Stasinopoulos and Rigby, 2007), for instance:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">4124</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="fl">2e3</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(n, <span class="dv">-2</span>, <span class="dv">2</span>); y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(n, <span class="dv">-2</span>, <span class="dv">2</span>);</a>
<a class="sourceLine" id="cb7-4" data-line-number="4"></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co"># Residuals are heteroscedastic w.r.t. x</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">ob &lt;-<span class="st"> </span>(x)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(y)<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>(<span class="fl">0.2</span><span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(x) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)  <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(n)</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gamV.html">gamV</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(ob <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(x, <span class="dt">k=</span><span class="dv">15</span>) <span class="op">+</span><span class="st"> </span><span class="kw">s</span>(y, <span class="dt">k=</span><span class="dv">15</span>), <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(x)), <span class="dt">family =</span> gaulss)</a>
<a class="sourceLine" id="cb7-8" data-line-number="8"></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="../reference/ALE.html">ALE</a></span>(b, <span class="dt">x =</span> <span class="st">"x"</span>, <span class="dt">oind =</span> <span class="dv">2</span>, <span class="dt">type =</span> <span class="st">"response"</span>))</a></code></pre></div>
<p><img src="miscellanea_files/figure-html/ALE6-1.png" width="480" style="display:block; margin: auto"> Above we are looking at the ALE effect of <code>x</code> for the second element of the model output (<code>oind = 2</code>). Given that <code>type == "response"</code>, we are looking at the reciprocal of the estimated standard deviation of the response variable (see <code>?gaulss</code> for details).</p>
<p>Finally, ALE effects can be plotted also for models fitted with <code>bam</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">dat &lt;-<span class="st"> </span><span class="kw">gamSim</span>(<span class="dv">1</span>,<span class="dt">n=</span><span class="dv">2000</span>,<span class="dt">dist=</span><span class="st">"poisson"</span>,<span class="dt">scale=</span>.<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## Gu &amp; Wahba 4 term additive model</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">bs &lt;-<span class="st"> "cr"</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">b2 &lt;-<span class="st"> </span><span class="kw">bam</span>(y<span class="op">~</span><span class="kw">s</span>(x0,<span class="dt">bs=</span>bs)<span class="op">+</span><span class="kw">s</span>(x1,<span class="dt">bs=</span>bs)<span class="op">+</span><span class="kw">s</span>(x2,<span class="dt">bs=</span>bs)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">            </span><span class="kw">s</span>(x3,<span class="dt">bs=</span>bs), <span class="dt">family=</span>poisson, <span class="dt">data=</span>dat)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="../reference/ALE.html">ALE</a></span>(b2, <span class="dt">x =</span> <span class="st">"x2"</span>))</a></code></pre></div>
<p><img src="miscellanea_files/figure-html/ALE6b-1.png" width="480" style="display:block; margin: auto"></p>
</div>
<div id="multinomial-example" class="section level2">
<h2 class="hasAnchor">
<a href="#multinomial-example" class="anchor"></a>Multinomial example</h2>
<p>ALE effects are particularly useful when working with multinomial regression models, because the parametrisation used under such models makes difficult to quantify the effects of the covariates on the probabilities of each response category. For example, here we fit at a multinomial regression model with three categories and two linear predictors:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">14714</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">2000</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(n)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co"># Both linear predictors increase with x</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">eta1 &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>x <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>x<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">eta2 &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span>x<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co"># Get probabilities for each x</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8">p &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="dv">0</span>,eta1,eta2))</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">p &lt;-<span class="st"> </span>p<span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(p) </a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co"># Simulate multinomial responses with these probabilities</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11">y &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(p, <span class="dv">1</span>, <span class="cf">function</span>(prob) <span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="dv">0</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">1</span>, <span class="dt">prob =</span> prob))</a>
<a class="sourceLine" id="cb11-12" data-line-number="12"></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co"># Fit multinomial GAM</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14">b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gamV.html">gamV</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(y<span class="op">~</span><span class="kw">s</span>(x),<span class="op">~</span><span class="kw">s</span>(x)),<span class="dt">family=</span><span class="kw">multinom</span>(<span class="dt">K=</span><span class="dv">2</span>))</a></code></pre></div>
<p>We now plot the effects of variable <code>x</code> on the two linear predictors:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(b), <span class="dt">pages =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="miscellanea_files/figure-html/ALE8-1.png" width="576" style="display:block; margin: auto"> Both linear predictors are increasing with <code>x</code>, hence we might conclude that the frequencies of categories 1 and 2 is increasing with <code>x</code>. But an ALE plot for the probability of observing category 2:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="../reference/ALE.html">ALE</a></span>(b, <span class="dt">x =</span> <span class="st">"x"</span>, <span class="dt">oind =</span> <span class="dv">3</span>, <span class="dt">type =</span> <span class="st">"response"</span>, <span class="dt">center =</span> <span class="dv">2</span>), <span class="dt">nsim =</span> <span class="dv">20</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/l_simLine.html">l_simLine</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/l_fitLine.html">l_fitLine</a></span>()</a></code></pre></div>
<p><img src="miscellanea_files/figure-html/ALE9-1.png" width="480" style="display:block; margin: auto"> shows that the probability of this category is actually decreasing with <code>x</code>. This is because the linear predictor of category 1 (<code>2*x + 2*x^2</code>) is increasing at a faster rate than that of category 2 (<code>x + x^2</code>), as we increase <code>x</code>. In this simple example featuring a single covariate the fact that the probability of category 2 is decreasing with <code>x</code> can be seen simply by plotting the data:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(x, y)</a></code></pre></div>
<p><img src="miscellanea_files/figure-html/ALE10-1.png" width="480" style="display:block; margin: auto"> but, when the number of covariates is greater than one, ALE plots can be very useful to assess the effect of the covariate on the actual probabilities.</p>
</div>
</div>
<div id="plotting-effects-of-gam-models-fitted-on-different-data" class="section level1">
<h1 class="hasAnchor">
<a href="#plotting-effects-of-gam-models-fitted-on-different-data" class="anchor"></a>Plotting effects of GAM models fitted on different data</h1>
<p>Often we want to fit the same GAM model (same formula) to different data, or to the same data but using different tuning parameters. If we have fitted <code>M</code> models, we might want to plot the <code>M</code> version of each effect in the same plot. This can by done using <code>plot.mgamViz</code>, which takes as input a list of GAM models (again, the model formula must be that same). Here we simulate <code>M=4</code> data sets:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mgcViz) <span class="co"># version 0.1.2 or later</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">M &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">n &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">dat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>M){</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb15-8" data-line-number="8">  dat[[ii]] &lt;-<span class="st"> </span><span class="kw">gamSim</span>(<span class="dv">1</span>,<span class="dt">n=</span>n,<span class="dt">dist=</span><span class="st">"normal"</span>,<span class="dt">scale=</span>ii) <span class="co"># Notice that scale = ii</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9">}</a></code></pre></div>
<p>We estimate <code>M</code> models and we put them in a list:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># Estimating model on each dataset</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">mods &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>M){</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">  mods[[ii]] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gamV.html">gamV</a></span>(y<span class="op">~</span><span class="kw">s</span>(x0)<span class="op">+</span><span class="kw">s</span>(x1, x2)<span class="op">+</span>x3, <span class="dt">data =</span> dat[[ii]])</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">}</a></code></pre></div>
<p>We give names to the list, which will be used to identify the plotted effects, and we plot:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(mods) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"M1"</span>, <span class="st">"M2"</span>, <span class="st">"M3"</span>, <span class="st">"M4"</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw"><a href="../reference/plot.mgamViz.html">plot.mgamViz</a></span>(mods, <span class="dt">select =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="miscellanea_files/figure-html/plot.mgamViz3-1.png" width="480" style="display:block; margin: auto"></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="../reference/plot.mgamViz.html">plot.mgamViz</a></span>(mods, <span class="dt">select =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Warning in f(...): Raster pixels are placed at uneven horizontal intervals
## and will be shifted. Consider using geom_tile() instead.</code></pre>
<pre><code>## Warning in f(...): Raster pixels are placed at uneven vertical intervals
## and will be shifted. Consider using geom_tile() instead.</code></pre>
<p><img src="miscellanea_files/figure-html/plot.mgamViz3-2.png" width="480" style="display:block; margin: auto"></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="../reference/plot.mgamViz.html">plot.mgamViz</a></span>(mods, <span class="dt">select =</span> <span class="dv">3</span>, <span class="dt">allTerms =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="miscellanea_files/figure-html/plot.mgamViz3-3.png" width="480" style="display:block; margin: auto"> Alternatively, we could use <code><a href="https://rdrr.io/r/graphics/plot.html">plot(getViz(mods))</a></code> to convert the list to an object of class <code>mgamViz</code>. We can also use custom layers:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw"><a href="../reference/sm.html">sm</a></span>(mods, <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/l_fitLine.html">l_fitLine</a></span>(<span class="dt">linetype =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="miscellanea_files/figure-html/plot.mgamViz4-1.png" width="480" style="display:block; margin: auto"></p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<ul>
<li><p>Apley, D.W., and Zhu, J, 2016. Visualizing the effects of predictor variables in black box supervised learning models. arXiv preprint arXiv:1612.08468.</p></li>
<li><p>Fasiolo, M., Nedellec, R., Goude, Y. and Wood, S.N., 2019. Scalable visualization methods for modern generalized additive models. Journal of computational and Graphical Statistics, pp.1-9.</p></li>
<li><p>Stasinopoulos, D.M. and Rigby, R.A., 2007. Generalized additive models for location scale and shape (GAMLSS) in R. Journal of Statistical Software, 23(7), pp.1-46.</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#accumulated-local-effect-ale-plot-for-gams">Accumulated local effect (ALE) plot for GAMs</a><ul class="nav nav-pills nav-stacked">
<li><a href="#basic-usage">Basic usage</a></li>
      <li><a href="#multinomial-example">Multinomial example</a></li>
      </ul>
</li>
      <li><a href="#plotting-effects-of-gam-models-fitted-on-different-data">Plotting effects of GAM models fitted on different data</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matteo Fasiolo, Raphael Nedellec.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
